---
cip: <to be assigned>
title: Error correction for BIP-39 mnemonic phrases
author: Victor Graf <@nategraf>
discussions-to: https://github.com/celo-org/celo-proposals/issues/225
status: Draft
type: Standards Track
category: 3
created: 2021-06-01
license: Apache 2.0
---

### Terminology

The key words "MUST", "MUST NOT", "SHOULD", and "MAY" in this document are to be interpreted as
described in [RFC 2119](https://www.rfc-editor.org/rfc/rfc2119.html).

## Simple Summary
Proposed in this CIP are two methods for providing error correction to mnemonic phrases in the
context of account recovery:

* In context where a new phrase is being generated, a backward-compatible extension to BIP-39 is
  proposed to add error correction information for guaranteed correction of a fixed number of error
  words.
* Additionally, a heuristic-based approach is discussed, including an edit-distance based
  instantiation and theoretical framework for extension to include improved rules.

## Abstract

<!-- TODO(victor) Possibly a bit long for an abstract -->
[BIP-39](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki) mnemonic phrases are widely
used as the seed for account generation in the crypto ecosystem, and a pen-and-paper backup is the
most commonly recommended way to store these phrases to enable account recovery.

In the case that the user has a copy of their phrase with errors, it is possible to recovery the
original phrase as long as the errors are relatively small. This CIP introduces a proposed standard
and framework for correcting errors based on the "noisy channel" model which is commonly used in
[spelling correction programs](https://norvig.com/spell-correct.html) to generate suggested
correction. An instantiation of this standard is described using Levenshtein distance, and assuming
a number of independent random errors are introduced to the mnemonic phrase.

Another approach is to add error correcting codes to the mnemonic phrase, which would allow for
correction of a limited number of arbitrary errors. This CIP proposes a fully-compatible extension
to BIP-39 in which some of the random words are replaced with "error correcting" words to produce an
instance of [Reed-Solomon](https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction)
coding. It is constructed to be interchangeable in applications that support BIP-39, whether or not
they support this proposal.

Note that neither of these ideas are entirely new, and have been discussed at various points in the
crypto community. This CIP aims to provide a standard and implementation to put these ideas into
production.

## Motivation

Mnemonic phrase backups are a powerful tool, but also place a large responsibility on the user to
correctly record and, in the future when an account needs to be recovered, recall the phrase. In
practice, us humans often make mistakes which lead to a phrase being lost or unusable. When this
happens, it can be a catastrophic event for the user, losing any assets or identity held by accounts
derived from the phrase.

In the case that the user has a copy of their phrase with errors, introduced when copying the phrase
to paper, during storage (e.g. water damage, dog nibbled on it), or when typing the phrase into a
wallet application, the raw data (i.e. entropy) may still be available in the key, but has been
obscured by the introduced errors. Given expertise and time, a user may being able to manually
locate and remove any errors present in the phrase. Most users don't have the required expertise or
time. This CIP aims to provide a standard way to remove these errors automatically.

When information is lost from the phrase (e.g. some of the words are entirely missing), or when the
heuristic does not do appropriately model a particular error, the heuristic based approach may fail.
The introduction of error correcting codes can allow for recovering phases with a number of
arbitrary errors, covering many cases that heuristic based approaches cannot.

## Specification

### Error correcting codes

Our aim in adding error correction codes to BIP-39 phrases is to produce a valid BIP-39 phrase,
which has a number of the random words replaced with valid "error correcting" words, containing
redundant information to the remaining words.

<!-- TODO(victor): Clarify terms around whether these are Reed-Solomon or BCH code words. In
particular, it should be possible for any implementation of this standard to accept phrases
generated by another -->

A mnemonic phrase generated in this scheme is interpreted as a systematic
[Reed-Solomon/BCH](https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction#The_BCH_view:_The_codeword_as_a_sequence_of_coefficients)
code word with `N` 11-bit symbols (i.e. BIP-39 words), of which `K` symbols form the message. The
remaining `N-K` symbols are considered the "error correcting" words, forming the tail of a
systematic code.

Each word in the phrase is coded as a symbol equal its index in the BIP-39 word
list for the phrase's language, cast to `GF(2^11)`. Code words MUST have a valid BIP-39
checksum to be considered valid phrases under this proposal.

<!-- TODO(victor): Can we relax the requirement that K be a multiple of 3? If so, should we? -->
`N` and `K` MAY be chosen by the user or application developer when generating a phrase. `N` MUST be
a multiple of 3 between 12 and 24 inclusive (i.e. It must be a valid number of words for BIP-39).
`K` MUST be a multiple of 3 between 12 and 24 inclusive, less than or equal to `N`. `K`

With a given selection of `N` and `K`, it will be possible to correct `N-K` symbols at known
locations (i.e. when the symbol is not a valid BIP-39 word, or is indicated as missing) and up to
`floor(N-K/2)` symbols at known locations (e.g. when word orderings are swapped, or replaced with
another valid BIP-39 word).

#### Generation

WIP


### Heuristic-based correction

WIP

Heuristic based approaches can correct a errors which are well-modeled by the "noisy channel". In
cases where the error is not well modeled, or reduce the information content of the phrase to a
significant extent, it may not be possible to recovery the original phrase.

## Rationale
The rationale fleshes out the specification by describing what motivated the design and why particular design decisions were made. It should describe alternate designs that were considered and related work, e.g. how the feature is supported in other languages. The rationale may also provide evidence of consensus within the community, and should discuss important objections or concerns raised during discussion.

## Backwards Compatibility

BIP-39 implementations will accept mnemonic phrases generated with error correction under this
proposal, as described above. Compatibility of clients implementing this proposal with existing
BIP-39 phrases is described above.

Heuristic-based error correction described above does not introduce any concerns with backwards
compatibility. Implementations of this model also need not be deterministic, or otherwise return
results consistent with each other.

## Test Cases

WIP

## Implementation

WIP

* A proof-of-concept implementation of phrases with error-correcting codes: [nategraf/cip39](https://github.com/nategraf/cip39)
* An implementation of heuristic-based mnemonic phrase correction is implemented in [celo-org/celo-monorepo/pull/8034](https://github.com/celo-org/celo-monorepo/pull/8034)

## Security Considerations

WIP

## License
This work is licensed under the Apache License, Version 2.0.
